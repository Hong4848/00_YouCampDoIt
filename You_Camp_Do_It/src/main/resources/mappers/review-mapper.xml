<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "mybatis-3-mapper.dtd" >
<mapper namespace="reviewMapper">
  
  <resultMap id="reviewResultMap" type="review">
  	<id column="REVIEW_NO" property="reviewNo" />
  	<result column="REVIEW_TITLE" property="reviewTitle" />
  	<result column="REVIEW_CONTENT" property="reviewContent" />
  	<result column="REVIEW_COUNT" property="reviewCount" />
  	<result column="CREATE_DATE" property="createDate" />
  	<result column="REVIEW_WRITER" property="reviewWriter" />
  	<result column="MAINIMAGE" property="mainImage" />
  </resultMap>
  	
 	<resultMap id="reviewAttachments" type="reviewAttachment">
	   	<result column="FILE_NO" property="fileNo" />
	  	<result column="ORIGIN_NAME" property="originName" />
	  	<result column="CHANGE_NAME" property="changeName" />
	  	<result column="FILE_PATH" property="filePath" />
	  	<result column="UPLOAD_DATE" property="uploadDate" />
	  	<result column="FILE_LEVEL" property="fileLevel" />
	  	<result column="REVIEW_NO" property="reviewNo" /> 
   </resultMap>
  
  

  
   <select id="selectCount" resultType="_int">
        SELECT COUNT(*)
        FROM REVIEW
    </select>
    
    <!-- 목록조회 -->
    <select id="selectReviewList" resultMap="reviewResultMap">
	    SELECT R.REVIEW_NO
		      , TO_CHAR(CREATE_DATE, 'YYYY.MM.DD') AS "CREATE_DATE"
		      , REVIEW_TITLE
		      , CHANGE_NAME AS "MAINIMAGE"
		  FROM REVIEW R
		  JOIN REVIEW_ATTACHMENT A ON (R.REVIEW_NO = A.REVIEW_NO)
		 WHERE R.STATUS = 'Y'
		   AND FILE_LEVEL = 1
		 ORDER BY REVIEW_NO DESC
	</select>
    
    <!-- 이벤트 게시글 등록 -->
    <insert id="insertReview" parameterType="review">
    <selectKey keyProperty="reviewNo" resultType="int" order="BEFORE">
        SELECT REVIEW_SEQ.NEXTVAL FROM DUAL
    </selectKey>
    INSERT INTO REVIEW (
        REVIEW_NO,
        REVIEW_TITLE,
        REVIEW_CONTENT,
        CREATE_DATE,
        MEMBER_NO,
        REVIEW_WRITER
    ) VALUES (
        #{reviewNo},
        #{reviewTitle},
        #{reviewContent},
        SYSDATE,
        #{memberNo},
        #{reviewWriter}
    )
</insert>
    
    <!-- 이벤트 게시글 첨부파일 등록 -->
    <insert id="insertReviewAttachment" parameterType="reviewAttachment">
        INSERT INTO REVIEW_ATTACHMENT (
        	FILE_NO,
            ORIGIN_NAME,
            CHANGE_NAME,
            FILE_PATH,
            UPLOAD_DATE,
            FILE_LEVEL,
            STATUS,
            REVIEW_NO
        ) VALUES (
        	FILE_SEQ.NEXTVAL,
            #{originName},
            #{changeName},
            #{filePath},
            SYSDATE,
            #{fileLevel},
            'Y',
            #{reviewNo}
        )
    </insert>
  
  
</mapper>
